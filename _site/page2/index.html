<!DOCTYPE html>
<html lang="en">

<link rel="stylesheet" href="/js/prettify/prettify.css">
<script src="/js/prettify/prettify.js"></script>
<script type="text/javascript">
  $(function(){
    $("pre").addClass("prettyprint linenums");
    prettyPrint();
  });
</script>
<!--script src="/js/raphael-min.js"></script-->
<!--script src="/js/flowchart-min.js"></script-->

<head>
    <meta charset="UTF-8">
    <title>WordWorth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">WordWorth</a>
              </div>
              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="/">Home</a></li>
                    <li class="active visible-xs-block"><a href="/links.html">Links</a></li>
                    <li class="active"><a href="/archive.html">Archive</a></li>
                    <li class="active"><a href="/about.html">About</a></li>
                    <li class="active"><a href="/feed.xml">RSS</a></li>
                    
                      <li class="active"><a href="https://github.com/sosohu/sosohu.github.io">Github</a></li>
                    
                </ul>
              </div>
        </div>
    </div>
</div>


<div class="container container-left">
    <div class="row">
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
sosohu
</div>

<div class="sidebar well">
    <h1>Recent Posts</h1>
    <ul>
        
          <li><a href="/2015/03/Xdotool%E6%A8%A1%E6%8B%9F%E5%B7%A5%E5%85%B7">Xdotool工具</a></li>
        
          <li><a href="/2015/02/Github-Jekyll-Markdown%E5%BC%80%E5%90%AF%E5%86%99%E4%BD%9C%E6%96%B0%E6%97%B6%E4%BB%A3">Github-Jekyll-Markdown开启写作新时代</a></li>
        
          <li><a href="/2015/02/Linux%E4%B8%8B%E5%B0%8F%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90">linux下小工具推荐</a></li>
        
          <li><a href="/2014/12/C++%E7%9A%84this%E6%8C%87%E9%92%88">C++的this指针</a></li>
        
    </ul>
</div>

<div class="sidebar well">
	 <h1>Category</h1> 
	 <ul>
		 
		<li><a href="/c&c++">c&c++ 1</a> </li>
		 
		<li><a href="/tool">tool 2</a> </li>
		 
		<li><a href="/experience">experience 1</a> </li>
		 
	 </ul> 
</div>

<div class="sidebar well">
<h1>Links</h1>
<ul>
  <li><a href="https://cn.linkedin.com/in/sosohu">My Linkedin</a></li>
  <li><a href="https://github.com/sosohu">My Github</a></li>
  <li><a href="http://www.cnblogs.com/sosohu/">My CnBlogs</a></li>
</ul>

</div>

        </div>
        <div class="col-md-9">
            
<div class="article">
    <div class="well">
        <h1><a href="/2014/12/C++%E7%9A%84this%E6%8C%87%E9%92%88">Dec 10, 2014 - C++的this指针 </a></h1>
        
          <p class="author"><a href="/2014/12/C++%E7%9A%84this%E6%8C%87%E9%92%88/#disqus_thread">Comments</a></p>
        
        <div class="content">
            <p>这篇博客主要内容翻译自国外著名程序员网站：<a href="http://www.geeksforgeeks.org">geekersforgeekers</a>,经过作者小幅度整理，水平有限，敬请指正.</p>

<h1 id="关于this指针的粗浅认识">关于this指针的粗浅认识</h1>

<h2 id="(一)-this指针：">(一)   this指针：</h2>

<p>在对象的任意非static类型的成员函数被调用时候，this指针会作为一个隐藏的参数被秘密的传递给该成员函数．</p>

<h2 id="(二)-this指针的类型：">(二)   this指针的类型：</h2>

<ul>
<li><p>首先，this指针本身是一个const类型的指针(注意是指针是const的，不是指向的对象是const的)，例如对于类X，那么它的this指针类型就是X * const</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">#include&lt;iostream&gt;
using namespace std;

class Test
{
    private:
        int x;
    public:
        Test(int x = 0) { this-&gt;x = x; }
        void change(Test *t) { this = t; } 
        //试图赋值失败，因为this是const类型指针
        void print() { cout &lt;&lt; &quot;x = &quot; &lt;&lt; x &lt;&lt; endl; }
};

int main()
{
    Test obj(5);
    Test *ptr = new Test (10);
    obj.change(ptr);
    obj.print();
    return 0;
}
</code></pre></div></li>
<li><p>另外，this指针指向的类型根据成员函数实际的类型确定，例如X有个const类型的成员函数, 那么this指针类型就const X * const</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include&lt;iostream&gt;</span>
<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">fun</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="c1">// this is passed as hidden argument to fun(). </span>
    <span class="c1">// Type of this is const X* </span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h2 id="(三)何时使用this指针">(三)何时使用this指针</h2></li>
<li><p>当局部变量与类成员变量同名</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">#include&lt;iostream&gt;
using namespace std;

/* local variable is same as a member&#39;s name */
class Test
{
private:
   int x;
public:
   void setX (int x)
   {
       // The &#39;this&#39; pointer is used to retrieve the object&#39;s x
       // hidden by the local variable &#39;x&#39;
       this-&gt;x = x;
   }
   void print() { cout &lt;&lt; &quot;x = &quot; &lt;&lt; x &lt;&lt; endl; }
};

int main()
{
   Test obj;
   int x = 20;
   obj.setX(x);
   obj.print();
   return 0;
}
</code></pre></div></li>
<li><p>返回调用对象的引用时候</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/* Reference to the calling object can be returned */
Test&amp; Test::func ()
{
   // Some processing
   return *this;
}
</code></pre></div></li>
</ul>

<h2 id="(四)delete-this指针">(四)delete this指针</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">什么？要删除this指针？对，你没有看错，就是要删出它，其实这也没什么奇怪的，需要注意的就是：
</code></pre></div>
<ul>
<li>   delete函数释放的只能是堆里面的内存，也就是说是new出来的空间</li>
<li>   delete完this指针之后，对象的所有成员都不能再被访问</li>
</ul>

<p>下面代码就会体现出来：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">class A
{
  public:
    void fun()
    {
        delete this;
    }
};

int main()
{
  /* Following is Valid */
  A *ptr = new A;
  ptr-&gt;fun ; // 没有问题
  ptr = NULL // make ptr NULL to make sure that things are not accessed using ptr. 


  /* And following is Invalid: Undefined Behavior */
  A a;
  a.fun();　// 释放栈上的空间，会出错

  getchar();
  return 0;
}
</code></pre></div>
        </div>
    </div>
</div>


<div class="pagination">
  
      
        <a class="btn btn-default" href="/index.html" class="previous">Newer</a>
      
  
  <span class="page_number ">Page: 2 of 2</span>
  
</div>

        </div>
    </div>
</div>

<!-- hitwebcounter Code START -->
<a href="http://www.hitwebcounter.com/" target="_blank">
<img src="http://hitwebcounter.com/counter/counter.php?page=6013407&style=0049&nbdigits=5&type=page&initCount=0" title="m" Alt="m"   border="0" >
</a><br/>
<!-- hitwebcounter.com --><a href="http://www.hitwebcounter.com/counterresources.php" title="Visits Total" 
target="_blank" style="font-family: Arial, Helvetica, sans-serif; 
font-size: 11px; color: #9C9E94; text-decoration: none ;"><strong>Visits Total</strong>
</a>   

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12 footer navbar-inverse navbar-fixed-bottom">
            <p class="copyright">&copy;2015 WordWorth. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="https://github.com/scotte/jekyll-clean">Scott Emmons</a>
            under
            <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution</a></p>
        </div>
    </div>
</div>


  <script type="text/javascript">
    var disqus_shortname = 'sosohu';

   (function () {
     var s = document.createElement('script'); s.async = true;
     s.type = 'text/javascript';
     s.src = '//' + disqus_shortname + '.disqus.com/count.js';
     (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
   }());
 </script>





</body>
</html>

